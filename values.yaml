replicaCount: 1

image:
  # Default image for the Jellycat Draft UI
  repository: ghcr.io/billy-davies-2/jellycat-draft-ui
  tag: latest
  pullPolicy: IfNotPresent
  # Optional: override tag without changing values.yaml (e.g. for CI/CD)
  tagOverride: ""

imagePullSecrets: [] # e.g., [{ name: ghcr-creds }]

service:
  type: ClusterIP
  port: 3000
  annotations: {}

# Ingress (use OR HTTPRoute)
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
  tls: [] # e.g., [{ hosts: [example.com], secretName: jellycat-ui-tls }]

# HTTPRoute (Gateway API). Do not enable with Ingress.
httpRoute:
  enabled: false
  # Reference to an existing Gateway
  gateway:
    name: ""
    namespace: ""
  parentRefs: [] # advanced: override parentRefs directly
  hostnames: []  # e.g., ["ui.example.com"]
  annotations: {}
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      filters: []

healthPath: /api/health

# Use envFrom sources (ConfigMap/Secret) via values like:
# extraEnv:
#   - secretRef:
#       name: my-secret
extraEnv: []

resources:
  requests:
    cpu: 50m
    memory: 128Mi
  limits:
    cpu: 200m
    memory: 256Mi

podAnnotations: {}
nodeSelector: {}
tolerations: []
affinity: {}

nameOverride: ""
fullnameOverride: ""

auth:
  enabled: false
  # Authentik endpoints
  baseURL: ""   # e.g., https://auth.example.com
  issuerURL: "" # e.g., https://auth.example.com/application/o/jellycat/
  clientID: ""
  # Mount a CA bundle for self-signed Authentik
  caSecretName: "" # secret with key ca.crt to trust Authentik's CA

  # Vault CSI (recommended)
  vault:
    enabled: false
    secretProviderClassName: ""
    secretName: "" # k8s Secret name synced by SPC
    # Optional: provide raw SecretProviderClass spec to render this chart's SPC
    # If set, the chart will create a SecretProviderClass named above.
    # Example structure depends on provider (Vault/Azure/GCP). Keep generic.
    spec: {}
    keys:
      clientSecret: clientSecret
      nextAuthSecret: NEXTAUTH_SECRET

  # NextAuth configuration
  nextAuth:
    enabled: false
    publicURL: "" # External URL of your app
    secret: ""    # NEXTAUTH_SECRET (if not using Vault sync)

  # Better Auth (v2) configuration (optional)
  # If not specified, the chart will reuse nextAuth.publicURL and nextAuth secret.
  betterAuth:
    url: ""
    secretKey: ""  # override to use a different secret key name in Secret; default uses NEXTAUTH_SECRET

  # Authorization via configurable claim/value (e.g., groups includes homelab-admins)
  adminClaim: ""
  adminValue: ""

serviceAccount:
  create: true
  name: ""

# Database configuration
db:
  driver: "" # e.g., postgres | clickhouse
  postgres:
    # Prefer reading from Vault-synced Secret
    secretKey: DATABASE_URL
    # Optional direct value (discouraged in prod)
    value: ""
  clickhouse:
    # Prefer a single URL in secret (e.g., http://user:pass@clickhouse:8123?database=db)
    urlSecretKey: CLICKHOUSE_URL
    url: ""
    # Or provide pieces:
    database: ""
    userSecretKey: CLICKHOUSE_USER
    passwordSecretKey: CLICKHOUSE_PASSWORD
    # Optional table/query overrides
    pointsTable: ""
    pointsQuery: ""

# NATS configuration (server-side + optional browser WS URL)
nats:
  enabled: false
  # Direct values (ok for dev); in prod prefer Vault-synced Secret referenced by auth.vault.secretName
  url: ""           # e.g., nats://nats.nats.svc:4222
  wsUrl: ""         # e.g., wss://nats.example.com (if exposing NATS WebSocket externally)
  # Keys to read from the Vault-synced Secret (ui-auth-secrets)
  urlSecretKey: NATS_URL
  wsUrlSecretKey: NATS_WS_URL
  usernameSecretKey: NATS_USERNAME
  passwordSecretKey: NATS_PASSWORD
  credsSecretKey: NATS_CREDS

# Optional NetworkPolicy (disabled by default)
networkPolicy:
  enabled: false
  # When enabled, allow egress to NATS service (namespace/name) on standard ports
  natsNamespace: nats
  natsServiceName: nats
  ports:
    - 4222

# ExternalSecrets integration (external-secrets.io)
externalSecrets:
  enabled: false

# ServiceMonitor (Prometheus Operator) optional
serviceMonitor:
  enabled: false
  labels: {}
  interval: 30s
  scrapeTimeout: 10s
  namespace: ""
  # Metrics endpoint details
  portName: http
  path: /api/metrics
  scheme: http
  # Name of the ExternalSecret resource; defaults to release fullname when empty
  name: ""
  # Name of the Secret to be created by ExternalSecrets; defaults to auth.vault.secretName when empty
  secretName: ""
  # Reference to the ClusterSecretStore/SecretStore
  secretStoreRef:
    name: ""          # required when externalSecrets.enabled=true
    kind: ClusterSecretStore
  # Refresh interval for pulling secrets
  refreshInterval: 1h
  # Where in the provider the secrets live (e.g. Vault path, AWS SecretsManager key)
  remoteRef:
    # Base path/prefix; individual keys are appended to this
    # Example for Vault: "secret/data/jellycat/ui"
    basePath: ""
  # Map of logical keys to external provider properties
  # These default to the existing keys used in the Deployment env vars.
  data:
    # Auth / NextAuth / Better Auth
    clientSecretKey: clientSecret
    nextAuthSecretKey: NEXTAUTH_SECRET
    # Database
    databaseUrlKey: DATABASE_URL
    # ClickHouse
    clickhouseUrlKey: CLICKHOUSE_URL
    clickhouseUserKey: CLICKHOUSE_USER
    clickhousePasswordKey: CLICKHOUSE_PASSWORD
    # NATS
    natsUrlKey: NATS_URL
    natsWsUrlKey: NATS_WS_URL
    natsUsernameKey: NATS_USERNAME
    natsPasswordKey: NATS_PASSWORD
    natsCredsKey: NATS_CREDS
