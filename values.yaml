replicaCount: 1

image:
  # Default image for the Jellycat Draft UI (Go-based microservice)
  repository: ghcr.io/billy-davies-2/jellycat-draft-ui
  tag: latest
  pullPolicy: IfNotPresent
  # Optional: override tag without changing values.yaml (e.g. for CI/CD)
  tagOverride: ""

imagePullSecrets: [] # e.g., [{ name: ghcr-creds }]

service:
  type: ClusterIP
  port: 3000      # HTTP server port
  grpcPort: 50051 # gRPC server port
  annotations: {}

# Ingress (use OR HTTPRoute)
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: ""
      paths:
        - path: /
          pathType: Prefix
  tls: [] # e.g., [{ hosts: [example.com], secretName: jellycat-ui-tls }]

# HTTPRoute (Gateway API). Do not enable with Ingress.
httpRoute:
  enabled: false
  # Reference to an existing Gateway
  gateway:
    name: ""
    namespace: ""
  parentRefs: [] # advanced: override parentRefs directly
  hostnames: []  # e.g., ["ui.example.com"]
  annotations: {}
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      filters: []

# Health check paths for Go application
healthPath: /api/health    # Legacy health check endpoint
livenessPath: /healthz     # Kubernetes liveness probe
readinessPath: /readyz     # Kubernetes readiness probe

# Environment mode (development uses mocks, production uses real services)
environment: production  # development | production

# Use envFrom sources (ConfigMap/Secret) via values like:
# extraEnv:
#   - secretRef:
#       name: my-secret
extraEnv: []

# gRPC server configuration
grpc:
  enabled: true
  port: 50051

resources:
  requests:
    cpu: 50m
    memory: 64Mi   # Go uses less memory than Node.js
  limits:
    cpu: 200m
    memory: 128Mi  # Go uses less memory than Node.js

podAnnotations: {}
nodeSelector: {}
tolerations: []
affinity: {}

nameOverride: ""
fullnameOverride: ""

auth:
  enabled: true
  # Authentik OAuth2 endpoints (Go application uses OAuth2, not NextAuth)
  baseURL: ""   # e.g., https://auth.example.com
  clientID: ""
  redirectURL: "" # e.g., https://ui.example.com/auth/callback
  scopes: "openid,profile,email" # Comma-separated OAuth2 scopes
  # Mount a CA bundle for self-signed Authentik
  caSecretName: "" # secret with key ca.crt to trust Authentik's CA

  # Vault CSI (recommended)
  vault:
    enabled: true
    secretProviderClassName: ""
    secretName: "jellycat-ui-secrets" # k8s Secret name synced by SPC
    # Optional: provide raw SecretProviderClass spec to render this chart's SPC
    # If set, the chart will create a SecretProviderClass named above.
    # Example structure depends on provider (Vault/Azure/GCP). Keep generic.
    spec: {}
    keys:
      clientSecret: clientSecret

  # Authorization via configurable claim/value (e.g., groups includes admins)
  adminClaim: "groups"
  adminValue: "admins"

serviceAccount:
  create: true
  name: ""

# Database configuration
db:
  driver: "postgres" # memory | sqlite | postgres (production default)
  postgres:
    # Prefer reading from Vault-synced Secret
    secretKey: DATABASE_URL
    # Optional direct value (discouraged in prod)
    value: ""
  sqlite:
    # SQLite file path (default: dev.sqlite)
    file: "dev.sqlite"
  clickhouse:
    # ClickHouse address (e.g., localhost:9000)
    addrSecretKey: CLICKHOUSE_ADDR
    url: ""
    # Database name
    database: "default"
    dbSecretKey: CLICKHOUSE_DB
    userSecretKey: CLICKHOUSE_USER
    passwordSecretKey: CLICKHOUSE_PASSWORD

# NATS configuration (server-side + optional browser WS URL)
nats:
  enabled: true
  # Direct values (ok for dev); in prod prefer Vault-synced Secret referenced by auth.vault.secretName
  url: ""           # e.g., nats://nats.nats.svc:4222
  subject: "draft.events" # NATS JetStream subject for draft events
  # Keys to read from the Vault-synced Secret (ui-auth-secrets)
  urlSecretKey: NATS_URL
  subjectSecretKey: NATS_SUBJECT
  usernameSecretKey: NATS_USERNAME
  passwordSecretKey: NATS_PASSWORD
  credsSecretKey: NATS_CREDS

# Optional NetworkPolicy (disabled by default)
networkPolicy:
  enabled: false
  # When enabled, allow egress to NATS service (namespace/name) on standard ports
  natsNamespace: nats
  natsServiceName: nats
  ports:
    - 4222

# ExternalSecrets integration (external-secrets.io)
externalSecrets:
  enabled: false

# ServiceMonitor (Prometheus Operator) optional
serviceMonitor:
  enabled: false
  labels: {}
  interval: 30s
  scrapeTimeout: 10s
  namespace: ""
  # Metrics endpoint details
  portName: http
  path: /api/metrics
  scheme: http
  # Name of the ExternalSecret resource; defaults to release fullname when empty
  name: ""
  # Name of the Secret to be created by ExternalSecrets; defaults to auth.vault.secretName when empty
  secretName: ""
  # Reference to the ClusterSecretStore/SecretStore
  secretStoreRef:
    name: ""          # required when externalSecrets.enabled=true
    kind: ClusterSecretStore
  # Refresh interval for pulling secrets
  refreshInterval: 1h
  # Where in the provider the secrets live (e.g. Vault path, AWS SecretsManager key)
  remoteRef:
    # Base path/prefix; individual keys are appended to this
    # Example for Vault: "secret/data/jellycat/ui"
    basePath: ""
  # Map of logical keys to external provider properties
  # These default to the existing keys used in the Deployment env vars.
  data:
    # Auth / Authentik OAuth2
    clientSecretKey: clientSecret
    # Database
    databaseUrlKey: DATABASE_URL
    # ClickHouse
    clickhouseAddrKey: CLICKHOUSE_ADDR
    clickhouseDbKey: CLICKHOUSE_DB
    clickhouseUserKey: CLICKHOUSE_USER
    clickhousePasswordKey: CLICKHOUSE_PASSWORD
    # NATS
    natsUrlKey: NATS_URL
    natsSubjectKey: NATS_SUBJECT
    natsUsernameKey: NATS_USERNAME
    natsPasswordKey: NATS_PASSWORD
    natsCredsKey: NATS_CREDS
